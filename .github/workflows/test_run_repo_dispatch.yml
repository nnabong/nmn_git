name: Test Run - Repository Dispatch

on:
  repository_dispatch:
    types:
      [
        test_run_repo_dispatch,
      ]

env:
  app_name:  ${{ github.event.client_payload.app_name }}
  payload: ${{ toJSON(github.event.client_payload) }}
  ticket_number: ${{ github.event.client_payload.servicenow_details.ticket_number }}
  snow_instance: ${{ github.event.client_payload.servicenow_details.snow_instance }}
  ANSIBLE_FORCE_COLOR: '1'


jobs:
    ## JOB: Create Azure App Registration
    azure_ad_app_registration:
      name: Create Azure App Registration
      runs-on: ubuntu-latest
      timeout-minutes: 20

      defaults:
        run:
          working-directory: "/home/runner/work/nmn_git/nmn_git"

      steps:
        - name: Echo out the input variables
          run: |
            echo 'client_payload: ${{ env.payload }}'

        ## Run PS1 Script
        - name: Run Ansible for PS1
          run: |
            echo $(pwd)
            cd /home/runner/work/nmn_git/nmn_git
            ls -l
            ansible-playbook AMIS/product/prod2/test_ps1.yml
